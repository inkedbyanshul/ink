<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inked By Anshul - Get Yours Book Now!</title>
    <link rel="shortcut icon" href="./signaturefavicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="./assets/css/style.css">
    <link rel="stylesheet" href="./assets/css/style2.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.emailjs.com/sdk/2.3.2/email.min.js"></script>
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }
        .form-group {
            margin-bottom: 15px;
        }
        input, select {
            width: 100%;
            padding: 13px;
            border: 2px solid white;
            background-color: #00001F;
            color: #ffffff; /* Accent color */
            border-radius: 50px;
            outline: none;
            font-size: 16px;
        }
        button.order-btn {
            display: block;
            margin: 20px auto;
            padding: 12px 25px;
            font-size: 18px;
            font-weight: bold;
            background-color: white;
            color: #00001F; /* Theme color */
            border: 2px solid white;
            border-radius: 50px;
            cursor: pointer;
            text-align: center;
            transition: 0.3s;
        }
        button.order-btn:hover {
            background-color: #ff5733;
            color: white;
        }
        #total-price {
            font-size: 20px;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body id="top">
    <main>
        <article>
            <h2><center>Shipping Address (Free Shipping in Delhi NCR)</center></h2>
            <form id="shipping-form">
                <div class="form-group">
                    <label for="name">Name:</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number:</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="address">Address:</label>
                    <input type="text" id="address" name="address" required>
                </div>
                <div class="form-group">
                    <label for="city">City:</label>
                    <input type="text" id="city" name="city" required>
                </div>
                <div class="form-group">
                    <label for="state">State:</label>
                    <select id="state" name="state" required>
                        <option value="">Select State</option>
                        <option value="Andhra Pradesh">Andhra Pradesh</option>
                        <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                        <option value="Assam">Assam</option>
                        <option value="Bihar">Bihar</option>
                        <option value="Chhattisgarh">Chhattisgarh</option>
                        <option value="Delhi">Delhi</option>
                        <option value="Goa">Goa</option>
                        <option value="Gujarat">Gujarat</option>
                        <option value="Haryana">Haryana</option>
                        <option value="Himachal Pradesh">Himachal Pradesh</option>
                        <option value="Jharkhand">Jharkhand</option>
                        <option value="Karnataka">Karnataka</option>
                        <option value="Kerala">Kerala</option>
                        <option value="Madhya Pradesh">Madhya Pradesh</option>
                        <option value="Maharashtra">Maharashtra</option>
                        <option value="Manipur">Manipur</option>
                        <option value="Meghalaya">Meghalaya</option>
                        <option value="Mizoram">Mizoram</option>
                        <option value="Nagaland">Nagaland</option>
                        <option value="Odisha">Odisha</option>
                        <option value="Punjab">Punjab</option>
                        <option value="Rajasthan">Rajasthan</option>
                        <option value="Sikkim">Sikkim</option>
                        <option value="Tamil Nadu">Tamil Nadu</option>
                        <option value="Telangana">Telangana</option>
                        <option value="Tripura">Tripura</option>
                        <option value="Uttar Pradesh">Uttar Pradesh</option>
                        <option value="Uttarakhand">Uttarakhand</option>
                        <option value="West Bengal">West Bengal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="pincode">Pincode:</label>
                    <input type="text" id="pincode" name="pincode" required>
                </div>
                <div id="total-price">Total: ₹137</div>
                <button type="submit" class="order-btn" id="order-btn">Order @ ₹137</button>
            </form>
        </article>
    </main>
    <script>
        emailjs.init("-M2E86myTW1WMc8Gy"); // Replace with your actual public key

        document.getElementById('shipping-form').addEventListener('submit', sendEmail);
        document.getElementById("state").addEventListener("change", updatePrice);
        document.getElementById("pincode").addEventListener("input", updatePrice);

        function updatePrice() {
            let selectedState = document.getElementById("state").value;
            let pincode = document.getElementById("pincode").value;
            let basePrice = 137;
            let delhiCharge = 15;
            let upHaryanaCharge = 3;
            let extraCharge = 50;
            let totalPrice = basePrice;

            // List of Western UP + Southern Saharanpur + NCR Haryana pincodes
            let validPincodes = [
                // Western UP
                "201001", "201002", "201003", "201004", "201005", "201006", // Ghaziabad
                "202001", "202002", "202003", // Aligarh
                "203001", "203002", "203003", // Bulandshahr
                "204101", "204102", "204103", // Hathras
                "250001", "250002", "250003", // Meerut
                "251001", "251002", "251003", // Muzaffarnagar

                // Southern Saharanpur (Deoband, Rampur Maniharan, Nakur, Gangoh)
                "247554", "247551", "247552", "247554", "247555", // Deoband
                "247451", "247452", "247453", "247454", // Rampur Maniharan
                "247340", "247341", "247342", // Nakur
                "247341", "247343", "247344", // Gangoh

                // NCR Haryana
                "122001", "122002", "122003", "122004", "122005", "122006", "122007", // Gurugram
                "121001", "121002", "121003", "121004", "121005", "121006", "121007", // Faridabad
                "131001", "131002", "131021", "131023", "131029", // Sonipat
                "124507", "124505", "124506", // Bahadurgarh
                "121102", "121105", "121106", "121107" // Palwal
            ];

            // Apply shipping charge logic
            if (selectedState === "Delhi") {
                totalPrice += delhiCharge;
            } else if (validPincodes.includes(pincode)) {
                totalPrice += upHaryanaCharge; // Add ₹3 for Western UP & NCR Haryana
            } else {
                totalPrice += extraCharge; // Add ₹50 for all other regions
            }

            // Update the Order button and total price dynamically
            document.getElementById("order-btn").innerText = "Order @ ₹" + totalPrice;
            document.getElementById("total-price").innerText = "Total: ₹" + totalPrice;
            document.getElementById("order-btn").setAttribute("data-price", totalPrice); // Store the price
        }

        function sendEmail(event) {
            event.preventDefault(); // Prevent default form submission

            var templateParams = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                pincode: document.getElementById('pincode').value,
            };

            emailjs.send('service_99nfqru', 'template_oemsjif', templateParams)
                .then(function(response) {
                    console.log('SUCCESS!', response.status, response.text);
                    processPayment(event); // Call processPayment after successful email sending
                }, function(error) {
                    console.log('FAILED...', error);
                    alert('Error sending order details. Please try again.');
                });
        }

        function processPayment(event) {
            let totalPrice = document.getElementById("order-btn").getAttribute("data-price") || 137;
            let upiID = "7983239853@mbk"; // Your UPI ID
            let paymentLink = `upi://pay?pa=${upiID}&pn=INKED%20BY%20ANSHUL&mc=&tid=&tr=&tn=Book%20Purchase&am=${totalPrice}&cu=INR`;
            window.location.href = paymentLink; // Redirect user to UPI payment
        }
    </script>
</body>
</html>
